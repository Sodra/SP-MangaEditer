<!DOCTYPE html><html><head><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script><style>canvas{border:1px solid #000}</style></head><body><canvas id="canvas" width="800" height="800"></canvas><button id="drawLineBtn">対角線を引く</button><script>const canvas=new fabric.Canvas("canvas"),rect=new fabric.Polygon([{x:50,y:100},{x:250,y:100},{x:200,y:300},{x:100,y:300}],{fill:"white",stroke:"black",strokeWidth:2});function drawDiagonalLine(){const n=50,a=100,t=300,e=Math.random()<.5;if(console.log("isTopEdge",e),e){const e=200,c=.25*e,r=n+c+Math.random()*(e-2*c),i=a;for(;;){var o=20*Math.random();r>100&&(o=90*Math.random());const c=calculateIntersection(n,a,100,t,200,300,o);if(null==c)continue;if(.25*e>c.x-n||.75*e<c.x-n)continue;const s=new fabric.Line([r,i,c.x,c.y],{stroke:"red",strokeWidth:2});canvas.add(s);break}}else{const t=200,e=.25*t,c=a+e+Math.random()*(t-2*e),r=n+(c-a)*.25;for(;;){o=20*Math.random();c>100&&(o=90*Math.random());const e=calculateIntersection(n,a,250,100,200,300,o);if(null==e)continue;if(.25*t>e.y-a||.75*t<e.y-a)continue;const i=new fabric.Line([r,c,e.x,e.y],{stroke:"red",strokeWidth:2});canvas.add(i);break}}}function calculateIntersection(n,a,t,e,o,c,r){const i=r*(Math.PI/180),s=Math.tan(i),d=a-s*n,l=(c-e)/(o-t),h=(e-l*t-d)/(s-l),f=s*h+d,u=Math.min(t,o),m=Math.max(t,o);return h<u||h>m?null:{x:h,y:f}}canvas.add(rect),document.getElementById("drawLineBtn").addEventListener("click",drawDiagonalLine)</script></body></html>