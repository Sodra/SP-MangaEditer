<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fabric.js 縦書きカスタムテキストオブジェクト</title><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script></head><body><canvas id="canvas" width="500" height="500"></canvas><br><button id="alignLeft">左揃え</button> <button id="alignCenter">中央揃え</button> <button id="alignRight">右揃え</button><script>fabric.CustomText=fabric.util.createClass(fabric.IText,{type:"custom-text",fontSize:20,fontFamily:'"MS Mincho", "ＭＳ 明朝", serif',fill:"black",padding:5,lineSpacing:1.2,letterSpacing:.1,initialize:function(t,i){i||(i={}),this.callSuper("initialize",t,i),this._updateDimensions()},_updateDimensions:function(){const t=this.canvas?this.canvas.getContext("2d"):fabric.util.createCanvasElement().getContext("2d");t.font=this.fontSize+"px "+this.fontFamily;const i=this.text.split("\n"),e=Math.max(...i.map((t=>t.length))),n=Math.max(...this.text.split("").map((i=>t.measureText(i).width)))*(1+this.letterSpacing)*i.length+2*this.padding,a=e*this.fontSize*this.lineSpacing+2*this.padding;this.set({width:n,height:a})},_render:function(t){t.save(),t.font=this.fontSize+"px "+this.fontFamily,t.fillStyle=this.fill,t.textAlign="center",t.textBaseline="middle";const i=this.text.split("\n"),e=(this.width-2*this.padding)/i.length;i.forEach(((i,n)=>{const a=i.split(""),s=this.width-this.padding-e*(n+.5);a.forEach(((i,e)=>{const n=this.padding+e*this.fontSize*this.lineSpacing+this.fontSize/2;t.fillText(i,s,n)}))})),t.restore()},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{padding:this.padding,lineSpacing:this.lineSpacing,letterSpacing:this.letterSpacing})},_set:function(t,i){return this.callSuper("_set",t,i),["text","fontSize","fontFamily","lineSpacing","letterSpacing"].includes(t)&&this._updateDimensions(),this}});var canvas=new fabric.Canvas("canvas"),customText=new fabric.CustomText("縦書き\nテキスト",{left:100,top:50,fontSize:20,fill:"black",padding:5,lineSpacing:1.2,letterSpacing:.1});canvas.add(customText),["left","center","right"].forEach((function(t){document.getElementById("align"+t.charAt(0).toUpperCase()+t.slice(1)).addEventListener("click",(function(){customText.set("textAlign",t),canvas.renderAll()}))})),canvas.renderAll()</script></body></html>